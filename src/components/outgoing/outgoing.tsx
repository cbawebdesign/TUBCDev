import { useState, useEffect } from 'react';
import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "firebase/storage";
import { initialize, document } from '@ironcorelabs/ironweb';
import iconv from 'iconv-lite';

export default function OutgoingPage() {
  interface Document {
    title: string;
    content: string;
    change: string[];
    id: string;
  }
  const [selectedLines, setSelectedLines] = useState<{ [key: string]: boolean }>({});

  const [documents, setDocuments] = useState<{ change: string[] }[]>([]);
  const [documentsTwo, setDocumentsTwo] = useState<Document[]>([]);
  const [scriptStatus, setScriptStatus] = useState<'idle' | 'running' | 'success' | 'error'>('idle');

  const toggleLineSelection = (documentId: string, lineIndex: number) => {
    setSelectedLines(prevState => ({
      ...prevState,
      [`${documentId}-${lineIndex}`]: !prevState[`${documentId}-${lineIndex}`]
    }));
  };
  
  const deleteSelectedLines = () => {
    Object.keys(selectedLines).forEach(key => {
      if (selectedLines[key]) {
        const [documentId, lineIndex] = key.split('-');
        deleteLine(documentId, parseInt(lineIndex));
      }
    });
  };

  useEffect(() => {
    fetch('/api/data/data')
      .then(response => response.json())
      .then(data => {
        setDocuments(data);
      })
      .catch(error => console.error('Error fetching documents:', error));
  }, []);

  useEffect(() => {
    fetch('/api/datatwo/datatwo')
      .then(response => response.json())
      .then(data => {
        setDocumentsTwo(data);
      })
      .catch(error => console.error('Error fetching documentsTwo:', error));
  }, []);

// ... other code ...

const deleteLine = (documentId: string, lineIndex: number) => {
  fetch(`/api/datatwo/datatwo`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ documentId, lineIndex }),
  })
    .then(response => response.json())
    .then(updatedDocument => {
      setDocumentsTwo(prevDocuments => {
        return prevDocuments.map(document => {
          if (document.id === documentId) {
            return updatedDocument;
          } else {
            return document;
          }
        });
      });
    })
    .catch(error => console.error('Error deleting line:', error));
};
const triggerPythonScript = () => {
  setScriptStatus('running');
  fetch('/api/trigger/trigger', {
    method: 'POST',
  })
    .then(response => response.json())
    .then(data => {
      console.log('Python script executed:', data);
      setScriptStatus('success');
    })
    .catch(error => {
      console.error('Error running Python script:', error);
      setScriptStatus('error');
    });
};
return (
    <div>
       <button onClick={triggerPythonScript} style={{ backgroundColor: scriptStatus === 'running' ? 'gray' : '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', padding: '10px 20px', fontSize: '16px', margin: '0 0 20px 0' }}  disabled={scriptStatus === 'running' || scriptStatus === 'success' || scriptStatus === 'error'}
 >Pull Latest Changes</button>
  {scriptStatus === 'running' && <p>Function is scheduled to run...</p>}
  {scriptStatus === 'success' && <p>Updates pulled successfully, please wait 1-2 minutes and refresh your page.</p>}
  {scriptStatus === 'error' && <p>Updates pulled successfully, please wait 1-2 minutes and refresh your page.</p>}
      <div style={{ marginBottom: '20px', border: '2px solid fuchsia', padding: '10px' }}>
        <h2 style={{ color: 'fuchsia ', textAlign: 'center' }}>Weekly Changes:</h2>
        {documents.map((document, documentIndex) => (
          <div key={documentIndex}>
            {document.change && <pre>
              {document.change.map((change, lineIndex) => (
                <div key={lineIndex}>
                  {change}
                </div>
              ))}
            </pre>}
          </div>
        ))}
      </div>
      <div style={{ marginTop: '20px', border: '2px solid fuchsia', padding: '10px' }}>
      <h2 style={{ color: 'fuschia', textAlign: 'center' }}>NY Output Files Que:</h2>
      {documentsTwo.map((document, documentIndex) => (
        <div key={documentIndex}>
          {document.change && document.change.map((line, lineIndex) => (
            <div key={lineIndex} style={{ display: 'flex', alignItems: 'center', justifyContent: 'flex-start' }}>
              {lineIndex !== 0 && (
                <input
                  type="checkbox"
                  checked={selectedLines[`${document.id}-${lineIndex}`] || false}
                  onChange={() => toggleLineSelection(document.id, lineIndex)}
                />
              )}
              <pre style={{ marginRight: '10px' }}>{line}</pre>
            </div>
          ))}
        </div>
      ))}
<button onClick={deleteSelectedLines} style={{ backgroundColor: '#f44336', color: 'white', border: 'none', borderRadius: '4px', padding: '10px 20px', fontSize: '16px', cursor: 'pointer' }}>Delete Selected</button>    
</div>
   

    <div style={{ marginTop: '20px', border: '2px solid fuchsia', padding: '10px' }}>
  <h2 style={{ color: 'fucshia', textAlign: 'center' }}>Sent NY Files:</h2>
  <pre>
  {`
0258110     F459270002581100000002025-12-118271C2025-12-11605BM68419999-12-310000000001950

0271854     F459270002718540000002025-12-118271C2025-12-11605BM68419999-12-310000000004060

0338352     F459270003383520000002025-12-118271C2025-12-11605BM68419999-12-310000000001750

0339406     F459270003394060000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

0460444     F459270004604440000002025-12-118271C2025-12-11605BM68419999-12-310000000001050

0494131     F459270004941310000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

0497742     F459270004977420000002025-12-118271C2025-12-11605BM68419999-12-310000000002550

0541396     F459270005413960000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

0549308     F459270005493080000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

0564236     F459270005642360000002025-12-118271C2025-12-11605BM68419999-12-310000000001500

0564274     F459270005642740000002025-12-118271C2025-12-11605BM68419999-12-310000000004900

0585337     F459270005853370000002025-12-118271C2025-12-11605BM68419999-12-310000000001950

0600071     F459270006000710000002025-12-118271C2025-12-11605BM68419999-12-310000000000900

0600084     F459270006000840000002025-12-118271C2025-12-11605BM68419999-12-310000000001550

0611190     F459270006111900000002025-12-118271C2025-12-11605BM68419999-12-310000000001450

0632092     F459270006320920000002025-12-118271C2025-12-11605BM68419999-12-310000000002500

0839308     F459270008393080000002025-12-118271C2025-12-11605BM68419999-12-310000000001550

0845429     F459270008454290000002025-12-118271C2025-12-11605BM68419999-12-310000000003777

0984008     F459270009840080000002025-12-118271C2025-12-11605BM68419999-12-310000000000850

0986556     F459270009865560000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

0992214     F459270009922140000002025-12-118271C2025-12-11605BM68419999-12-310000000001050

0997016     F459270009970160000002025-12-118271C2025-12-11605BM68419999-12-310000000002000

1031841     F459270010318410000002025-12-118271C2025-12-11605BM68419999-12-310000000000900

1031848     F459270010318480000002025-12-118271C2025-12-11605BM68419999-12-310000000004403

1037239     F459270010372390000002025-12-118271C2025-12-11605BM68419999-12-310000000003150

1039835     F459270010398350000002025-12-118271C2025-12-11605BM68419999-12-310000000001550

1040185     F459270010401850000002025-12-118271C2025-12-11605BM68419999-12-310000000001400

1045002     F459270010450020000002025-12-118271C2025-12-11605BM68419999-12-310000000002500

1048933     F459270010489330000002025-12-118271C2025-12-11605BM68419999-12-310000000004137

1060532     F459270010605320000002025-12-118271C2025-12-11605BM68419999-12-310000000003150

1077645     F459270010776450000002025-12-118271C2025-12-11605BM68419999-12-310000000002250

1077669     F459270010776690000002025-12-118271C2025-12-11605BM68419999-12-310000000002200

1084597     F459270010845970000002025-12-118271C2025-12-11605BM68419999-12-310000000001250

1084601     F459270010846010000002025-12-118271C2025-12-11605BM68419999-12-310000000000850

1089297     F459270010892970000002025-12-118271C2025-12-11605BM68419999-12-310000000000900

1102874     F459270011028740000002025-12-118271C2025-12-11605BM68419999-12-310000000003140

1107224     F459270011072240000002025-12-118271C2025-12-11605BM68419999-12-310000000001500

1162261     F459270011622610000002025-12-118271C2025-12-11605BM68419999-12-310000000000700

1272506     F459270012725060000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

1289034     F459270012890340000002025-12-118271C2025-12-11605BM68419999-12-310000000001400

1294262     F459270012942620000002025-12-118271C2025-12-11605BM68419999-12-310000000002000

1298201     F459270012982010000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

1298267     F459270012982670000002025-12-118271C2025-12-11605BM68419999-12-310000000001200

1316833     F459270013168330000002025-12-118271C2025-12-11605BM68419999-12-310000000009037

1335213     F459270013352130000002025-12-118271C2025-12-11605BM68419999-12-310000000005053

1340092     F459270013400920000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

1340123     F459270013401230000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

1340152     F459270013401520000002025-12-118271C2025-12-11605BM68419999-12-310000000001600

1344496     F459270013444960000002025-12-118271C2025-12-11605BM68419999-12-310000000002000

1399184     F459270013991840000002025-12-118271C2025-12-11605BM68419999-12-310000000001050

1414978     F459270014149780000002025-12-118271C2025-12-11605BM68419999-12-310000000009827

1419582     F459270014195820000002025-12-118271C2025-12-11605BM68419999-12-310000000002200

1422040     F459270014220400000002025-12-118271C2025-12-11605BM68419999-12-310000000000850

1423104     F459270014231040000002025-12-118271C2025-12-11605BM68419999-12-310000000001400

1423163     F459270014231630000002025-12-118271C2025-12-11605BM68419999-12-310000000001050

1423267     F459270014232670000002025-12-118271C2025-12-11605BM68419999-12-310000000002412

1456242     F459270014562420000002025-12-118271C2025-12-11605BM68419999-12-310000000001950

1461512     F459270014615120000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

1461607     F459270014616070000002025-12-118271A2025-12-11605BM68419999-12-310000000007871

1461683     F459270014616830000002025-12-118271C2025-12-11605BM68419999-12-310000000001000

1467910     F459270014679100000002025-12-118271C2025-12-11605BM68419999-12-310000000008012

1468133     F459270014681330000002025-12-118271C2025-12-11605BM68419999-12-310000000001500

1474474     F459270014744740000002025-12-118271C2025-12-11605BM68419999-12-310000000001600

1491421     F459270014914210000002025-12-110721A2025-12-11605BM70449999-12-311000000007352

1509857     F459270015098570000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

1516294     F459270015162940000002025-12-118271C2025-12-11605BM68419999-12-310000000002000

1516736     F459270015167360000002025-12-118271C2025-12-11605BM68419999-12-310000000002650

1517632     F459270015176320000002025-12-118271C2025-12-11605BM68419999-12-310000000002977

1521626     F459270015216260000002025-12-118271C2025-12-11605BM68419999-12-310000000001350

1521669     F459270015216690000002025-12-118271C2025-12-11605BM68419999-12-310000000002700

1521671     F459270015216710000002025-12-118271C2025-12-11605BM68419999-12-310000000000850

1521698     F459270015216980000002025-12-118271C2025-12-11605BM68419999-12-310000000001600

1531729     F459270015317290000002025-12-118271C2025-12-11605BM68419999-12-310000000001200

1540228     F459270015402280000002025-12-118271A2025-12-11605BM68419999-12-310000000001027

1557328     F459270015573280000002025-12-118271C2025-12-11605BM68419999-12-310000000001150

1573234     F459270015732340000002025-12-118271C2025-12-11605BM68419999-12-310000000000900

1582020     F459270015820200000002025-12-118271C2025-12-11605BM68419999-12-310000000001300

1582242     F459270015822420000002025-12-118271C2025-12-11605BM68419999-12-310000000001100

1601451     F459270016014510000002025-12-118271C2025-12-11605BM68419999-12-310000000002700

1612727     F459270016127270000002025-12-118271C2025-12-11605BM68419999-12-310000000001150

1617302     F459270016173020000002025-12-118271A2025-12-11605BM68419999-12-310000000000866

1626422     F459270016264220000002025-12-118271C2025-12-11605BM68419999-12-310000000002852

1626565     F459270016265650000002025-12-118271C2025-12-11605BM68419999-12-310000000007557

1637010     F459270016370100000002025-12-118271C2025-12-11605BM68419999-12-310000000001550

1672332     F459270016723320000002025-12-118271C2025-12-11605BM68419999-12-310000000002412

1683481     F459270016834810000002025-12-118271C2025-12-11605BM68419999-12-310000000002139

1683482     F459270016834820000002025-12-118271C2025-12-11605BM68419999-12-310000000001724

1683587     F459270016835870000002025-12-118271C2025-12-11605BM68419999-12-310000000002073

1683799     F459270016837990000002025-12-118271C2025-12-11605BM68419999-12-310000000001650

1690299     F459270016902990000002025-12-118271C2025-12-11605BM68419999-12-310000000002654

1702160     F459270017021600000002025-12-118271C2025-12-11605BM68419999-12-310000000002942

1707381     F459270017073810000002025-12-118271C2025-12-11605BM68419999-12-310000000001050

1730436     F459270017304360000002025-12-118271C2025-12-11605BM68419999-12-310000000001800

1839903     F459270018399030000002025-12-118271C2025-12-11605BM68419999-12-310000000001950

1840050     F459270018400500000002025-12-118271C2025-12-11605BM68419999-12-310000000002273

1840103     F459270018401030000002025-12-118271C2025-12-11605BM68419999-12-310000000007050

1842138     F459270018421380000002025-12-118271C2025-12-11605BM68419999-12-310000000001000

1845167     F459270018451670000002025-12-118271C2025-12-11605BM68419999-12-310000000001750

1850187     F459270018501870000002025-12-118271C2025-12-11605BM68419999-12-310000000001750

1850325     F459270018503250000002025-12-118271C2025-12-11605BM68419999-12-310000000003396

1850372     F459270018503720000002025-12-118271C2025-12-11605BM68419999-12-310000000002793

1854508     F459270018545080000002025-12-118271C2025-12-11605BM68419999-12-310000000003150

1854697     F459270018546970000002025-12-118271C2025-12-11605BM68419999-12-310000000006646

1861353     F459270018613530000002025-12-118271C2025-12-11605BM68419999-12-310000000000500

1864819     F459270018648190000002025-12-118271A2025-12-11605BM68419999-12-310000000000866

1866643     F459270018666430000002025-12-118271C2025-12-11605BM68419999-12-310000000001500

1890095     F459270018900950000002025-12-118271C2025-12-11605BM68419999-12-310000000004904

1890364     F459270018903640000002025-12-118271C2025-12-11605BM68419999-12-310000000001500

1925399     F459270019253990000002025-12-118271C2025-12-11605BM68419999-12-310000000003592

1929319     F459270019293190000002025-12-118271A2025-12-11605BM68419999-12-310000000001212

1929379     F459270019293790000002025-12-118271C2025-12-11605BM68419999-12-310000000005866

2030169     F459270020301690000002025-12-118271A2025-12-11605BM68419999-12-310000000006092

2055987     F459270020559870000002025-12-118271A2025-12-11605BM68419999-12-310000000002102

2056011     F459270020560110000002025-12-118271A2025-12-11605BM68419999-12-310000000003872

2056026     F459270020560260000002025-12-118271A2025-12-11605BM68419999-12-310000000000635

2056049     F459270020560490000002025-12-118271A2025-12-11605BM68419999-12-310000000001373

2056208     F459270020562080000002025-12-118271A2025-12-11605BM68419999-12-310000000002331

2056267     F459270020562670000002025-12-118271A2025-12-11605BM68419999-12-310000000001373

2056276     F459270020562760000002025-12-118271A2025-12-11605BM68419999-12-310000000000946

2056279     F459270020562790000002025-12-118271A2025-12-11605BM68419999-12-310000000000912

2056293     F459270020562930000002025-12-118271A2025-12-11605BM68419999-12-310000000001892

2056307     F459270020563070000002025-12-118271A2025-12-11605BM68419999-12-310000000002146

2056448     F459270020564480000002025-12-118271A2025-12-11605BM68419999-12-310000000001172

2056467     F459270020564670000002025-12-118271A2025-12-11605BM68419999-12-310000000003958

2056483     F459270020564830000002025-12-118271A2025-12-11605BM68419999-12-310000000001639

2056486     F459270020564860000002025-12-118271A2025-12-11605BM68419999-12-310000000001731

2056534     F459270020565340000002025-12-118271A2025-12-11605BM68419999-12-310000000001292

2056569     F459270020565690000002025-12-118271A2025-12-11605BM68419999-12-310000000001639

2056664     F459270020566640000002025-12-118271A2025-12-11605BM68419999-12-310000000001500

2056673     F459270020566730000002025-12-118271A2025-12-11605BM68419999-12-310000000000946

2056723     F459270020567230000002025-12-118271A2025-12-11605BM68419999-12-310000000002492

2056734     F459270020567340000002025-12-118271A2025-12-11605BM68419999-12-310000000001027
`}
 </pre>
  <h2 style={{  textAlign: 'left' }}></h2>
  <pre>
    {`
`}
  </pre>
</div>

    </div>
    
  );
}